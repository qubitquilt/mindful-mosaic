# Story 1.6: E2E Testing Implementation

## Status
- [ ] Draft
- [ ] Approved
- [ ] In Progress
- [ ] Review
- [ ] Done

## Story
**As a** developer and QA team,
**I want** comprehensive E2E tests using Playwright for critical user journeys,
**so that** we ensure end-to-end functionality, reliability, and regression prevention across the application.

## Acceptance Criteria
1. Playwright is fully configured and integrated with the project (e.g., CI via turbo.json, multiple browsers: Chromium, Firefox, WebKit).
2. E2E tests cover Epic 1 core flows: Authentication (sign-in/sign-out with mock SSO), Layout/Navigation (header rendering, session-based visibility), Timeline View (empty state, time slots, responsiveness).
3. E2E tests cover Epic 2 routine flows: Create Routine (button click, modal open, form validation, save submission, success toast), Display Routines (fetch and render blocks on timeline, expand/collapse tasks).
4. Tests use mocks for external dependencies (e.g., NextAuth session, Google OAuth callback) to avoid real API calls.
5. All E2E tests pass locally (`npx playwright test`) and in CI; generate HTML report with coverage >80% for high-risk paths.
6. Update story QA sections to reference E2E results; require E2E pass for future story Done status.
7. Document E2E strategy in docs/qa/e2e-strategy.md (tools, coverage goals, maintenance guidelines).

## Tasks / Subtasks
- [ ] **Task 1: Configure Playwright (AC: 1)**
  - [ ] Update playwright.config.ts for multi-browser projects, trace on retry, video recording in CI.
  - [ ] Add E2E scripts to package.json (test, ui for visual review).
  - [ ] Integrate with turbo.json for monorepo CI pipeline.
- [ ] **Task 2: Implement Epic 1 E2E Tests (AC: 2-3)**
  - [ ] Enhance auth.spec.ts: Full mocked sign-in flow (button → signin page → callback → dashboard with sign-out).
  - [ ] Create layout.spec.ts: Verify header user info, conditional buttons, sign-out redirect.
  - [ ] Enhance timeline.spec.ts: Responsive rendering, empty state, slot visibility.
- [ ] **Task 3: Implement Epic 2 E2E Tests (AC: 3-4)**
  - [ ] Create routine-creation.spec.ts: Auth → create button → modal → add tasks → validate → save → toast → modal close.
  - [ ] Create routines-display.spec.ts: Save routine → refresh → timeline fetch → block render → click expand → task list visibility.
  - [ ] Mock API responses (fetch routines, session) using page.route.
- [ ] **Task 4: Verify and Document (AC: 5-7)**
  - [ ] Run all tests; fix flakiness (e.g., waits, selectors).
  - [ ] Generate coverage report; ensure 80%+ for auth/routine paths.
  - [ ] Create docs/qa/e2e-strategy.md with guidelines: Run commands, coverage thresholds, maintenance (update on UI changes).
  - [ ] Update existing story QA to include E2E verification.

## Dev Notes
Build on existing Playwright setup (auth/timeline specs). Use robust selectors (role/text over CSS). Mock external (OAuth) to keep tests fast/reliable. Defer full CI until after initial run.

**Previous Insights:** Unit/integration from 1.5 cover components/API; E2E validates flows. Playwright config exists; expand projects array.

**Tech Stack:** Playwright for E2E; integrate with Jest reporting if needed.

**File Locations:**
- Tests: apps/web/e2e/*.spec.ts
- Config: apps/web/playwright.config.ts
- Docs: docs/qa/e2e-strategy.md

### Testing
Meta-testing: Run E2E suite as part of this story verification.

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-09-10 | 1.0 | Initial draft based on QA assessment | Test Architect |

## Dev Agent Record
### Agent Model Used
(To be filled)

### Debug Log References
(To be filled)

### Completion Notes List
(To be filled)

### File List
(To be filled)

## QA Results
(To be filled)