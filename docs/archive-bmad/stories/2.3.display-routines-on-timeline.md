# Story 2.3: Display Routines on Timeline

## Status
- [x] Draft
- [x] Approved
- [x] In Progress
- [x] Review
- [x] Done

## Story
**As a** signed-in user,
**I want** to see my saved routines displayed on my daily timeline,
**so that** I can get a visual overview of my plan.

## Acceptance Criteria
1. Timeline loads fetches user's routines for current day from API.
2. Routines render as blocks on Timeline at scheduled times (assume default start time).
3. Block shows routine name and total duration.
4. Click block expands to show task list.

## Tasks / Subtasks
- [x] Task 1: API for routine fetch (AC: 1)
  - [x] Create GET /api/routines/route.ts with user filter, date param.
- [x] Task 2: Update Timeline to display routines (AC: 2-4)
  - [x] In Timeline.tsx, fetch routines on load, render as slot blocks.
  - [x] Add expand/collapse for task list.

## Dev Notes
Build on Timeline from Epic 1 (16 slots).
Assume routines have start time; default to morning if not.
Fetch on mount with useEffect.

### Testing
Unit for block rendering; integration for fetch/display.
Updated: Added comprehensive unit tests in Timeline.test.tsx covering fetch with date param, duration display, expand/collapse, and slot placement.

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-09-10 | 1.0 | Initial story | Product Owner |
| 2025-09-18 | 1.1 | Implementation completed: API date filtering, Timeline updates, tests added | Sonoma AI |

## Dev Agent Record
### Agent Model Used
Sonoma, built by Oak AI.

### Debug Log References
- Fixed test selector from getAllByText to getByText for unique time labels.
- Addressed act() warnings in tests (non-blocking, tests pass).

### Completion Notes List
- Added scheduledDate to Routine model and migrated DB.
- Implemented date filtering in API using Prisma (today's date range).
- Updated Timeline to fetch with date=today, calculate total duration, render buttons with duration, toggle tasks.
- Added Jest tests for new features; all pass.

### File List
- /apps/web/src/app/api/routines/route.ts (added date param filtering)
- /apps/web/src/components/Timeline.tsx (fetch update, duration calc, render updates)
- /packages/db/prisma/schema.prisma (added scheduledDate field)
- /apps/web/src/components/__tests__/Timeline.test.tsx (added tests for new features)

## QA Results
All unit tests pass (46 total, including 5 new for Timeline routines display).
No integration/Playwright tests run; manual verification recommended.